# Project 1: Data Modeling with Postgres

## Dataset Information

**Song Dataset** is a subset of real data from the [MillionSongDataSet](http://millionsongdataset.com/). Each file is in JSON format and contains metadata about a song and the artist of that song. The files are partitioned by the first three letters of each song's track ID. For example, here are file paths to two files in this 
>           song_data/A/B/C/TRABCEI128F424C983.json
>           song_data/A/A/B/TRAABJL12903CDCF1A.json

- Sample data: TRAABJL12903CDCF1A.json
>           {"num_songs": 1, "artist_id": "ARJIE2Y1187B994AB7", "artist_latitude": null, "artist_longitude": null, "artist_location": "", "artist_name": "Line Renaud", "song_id": "SOUPIRU12A6D4FA1E1", "title": "Der Kleine Dompfaff", "duration": 152.92036, "year": 0}
    
**Log Dataset** consists of log files in JSON format generated by this [event simulator](https://github.com/Interana/eventsim) based on the songs in the dataset above. These simulate activity logs from a music streaming app based on specified configurations. The log files in the dataset you'll be working with are partitioned by year and month. For example, here are filepaths to two files in this dataset. 
> log_data/2018/11/2018-11-12-events.json
> log_data/2018/11/2018-11-13-events.json

- Sample data:
>           {"artist":null,"auth":"Logged In","firstName":"Kaylee","gender":"F","itemInSession":0,"lastName":"Summers","length":null,"level":"free","location":"Phoenix-Mesa-Scottsdale, AZ","method":"GET","page":"Home","registration":1540344794796.0,"sessionId":139,"song":null,"status":200,"ts":1541106106796,"userAgent":"\"Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/35.0.1916.153 Safari\/537.36\"","userId":"8"}

## Schema for Song Play Analysis

Using the song and log datasets, you'll need to create a star schema optimized for queries on song play analysis. This includes the following tables.

### Fact Table

**songplays** - records in log data associated with song plays i.e. records with page NextSong
*songplay_id, start_time, user_id, level, song_id, artist_id, session_id, location, user_agent*

### Dimension Tables

**users** - users in the app. 
*user_id, first_name, last_name, gender, level*

**songs** - songs in music database. 
*song_id, title, artist_id, year, duration*

**artists** - artists in music database
*artist_id, name, location, latitude, longitude*

**time** - timestamps of records in songplays broken down into specific units
*start_time, hour, day, week, month, year, weekday*

## Files in Project workspace

* **test.ipynb** displays the first few rows of each table to let you check your database.
* **sql_queries.py** contains sql queries for creating, inserting and selecting fact and dimension tables.
* **create_tables.py** drops and creates your tables making use of sql_queries.py. You can also run this file to reset your tables before each time you run your ETL scripts.
* **etl.ipynb** is a test file I created that reads and processes a single file from song_data and log_data and loads them into your tables.
* **etl.py** reads and processes files from song_data and log_data and loads them into your tables.
* **ERDiagram.ipynb** contains the code to create the ERD for the connected data base and creates an image in the working directory with name **dbschema.png**.
* **requirements.txt** has the required dependencies. 
    Created this file in a local virtual environment using 
    >       pip freeze --local > requirements.txt
    Use below command to install dependencies of the project in your local branch:
    >       pip install -r requirements.txt
* **README.md** provides discussion on my project.

## How to run this project

* I also created a main.py that internally calls both of the above files, run below command in working directory:
    >       python main.py

## References
* [SQLAlchemy for ERDiagram](https://sarathlal.com/convert-sqlalchemy-db-model-into-entity-relationship-diagram-python/)
* [pip freeze](https://stackoverflow.com/questions/54931275/pip-freeze-local)
* [Markdown Guide](https://www.markdownguide.org/basic-syntax/#paragraphs-1)
* [Pandas DataFrame](https://www.geeksforgeeks.org/python-pandas-dataframe-loc/)

### Probable issue and links to fix them
* [psycopg2 can't adapt tyoe int64 or uni32](https://devpress.csdn.net/python/6304c8c2c67703293080df4e.html)
* [iterrows() index error](https://stackoverflow.com/questions/47665812/index-out-of-bound-when-iterrow-how-is-this-possible)
